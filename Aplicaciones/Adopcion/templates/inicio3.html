{% extends './plantilla.html' %}
{% block contenido %}
<br><br>

<div class="container">
    <h1>Listado de adopciones realizadas</h1>

    <a href="{% url 'nuevaAdopcion' %}" class="btn btn-primary">Agregar nueva adopción</a>
    <br><br>

    <table class="table table-bordered table-striped table-hover" id="tbl_ado">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre Adoptante</th>
                <th>Correo</th>
                <th>Teléfono</th>
                <th>Mascota</th>
                <th>Imagen</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for adopcion in adopciones %}
            <tr>
                <td>{{ adopcion.id }}</td>
                <td>{{ adopcion.nombre_adoptante }}</td>
                <td>{{ adopcion.correo }}</td>
                <td>{{ adopcion.telefono }}</td>
                <td>{{ adopcion.mascota.nombre }}</td>
                <td>
                    {% if adopcion.mascota.imgMascota %}
                        <img src="{{ adopcion.mascota.imgMascota.url }}" 
                             class="img-thumbnail" 
                             height="60" 
                             alt="{{ adopcion.mascota.nombre }}"
                             style="cursor: pointer;"
                             data-bs-toggle="modal" 
                             data-bs-target="#imagenModal{{ adopcion.id }}">
                    {% else %}
                        Sin imagen
                    {% endif %}
                </td>
                <td>{{ adopcion.fecha }}</td>
                <td>
                    <span class="badge 
                        {% if adopcion.estado == 'pendiente' %}bg-warning
                        {% elif adopcion.estado == 'aceptada' %}bg-success
                        {% else %}bg-danger{% endif %}">
                        {{ adopcion.estado }}
                    </span>
                </td>
                <td>
                    <a href="{% url 'editarAdopcion' adopcion.id %}" class="btn btn-outline-warning btn-sm">
                        <i class="fa fa-pen"></i>
                    </a>
                    <a href="{% url 'eliminarAdopcion' adopcion.id %}" class="btnEliminar btn btn-outline-danger btn-sm" data-id="{{ adopcion.id }}">
                        <i class="fa fa-trash"></i>
                    </a>

                    {% if adopcion.estado == 'pendiente' %}
                        <a href="{% url 'aceptarAdopcion' adopcion.id %}" class="btn btn-outline-success btn-sm">Aceptar</a>
                        <a href="{% url 'rechazarAdopcion' adopcion.id %}" class="btn btn-outline-secondary btn-sm">Rechazar</a>
                    {% endif %}
                </td>
            </tr>
            
            <!-- Modal para imagen ampliada -->
            <div class="modal fade" id="imagenModal{{ adopcion.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{{ adopcion.mascota.nombre }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-center">
                            {% if adopcion.mascota.imgMascota %}
                                <img src="{{ adopcion.mascota.imgMascota.url }}" class="img-fluid" alt="{{ adopcion.mascota.nombre }}">
                            {% endif %}
                            <p class="mt-3">
                                <strong>Adoptante:</strong> {{ adopcion.nombre_adoptante }}<br>
                                <strong>Especie:</strong> {{ adopcion.mascota.get_especie_display }}<br>
                                <strong>Edad:</strong> {{ adopcion.mascota.edad }} años
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const botonesEliminar = document.querySelectorAll(".btnEliminar");
    botonesEliminar.forEach(boton => {
        boton.addEventListener("click", function (e) {
            e.preventDefault(); 
            const url = this.getAttribute("href");
            Swal.fire({
                title: "¿Estás seguro?",
                text: "Esta acción no se puede deshacer",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Sí, eliminar",
                cancelButtonText: "Cancelar"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url; 
                }
            });
        });
    });
});

$(document).ready(function () {
    let table = new DataTable('#tbl_ado', {
        language: { url: 'https://cdn.datatables.net/plug-ins/2.3.1/i18n/es-ES.json' },
        dom: 'lBfrtip',
        pageLength: 10,
        buttons: [
          { extend: 'copy', text: 'Copiar', className: 'btn btn-primary me-2' },
          { extend: 'csv', text: 'CSV', className: 'btn btn-info me-2' },
          { extend: 'excel', text: 'Excel', className: 'btn btn-success me-2' },
          { extend: 'pdf', text: 'PDF', className: 'btn btn-danger me-2' },
          { extend: 'print', text: 'Imprimir', className: 'btn btn-secondary me-2' }
        ]
    });
});
</script>

<style>
.img-thumbnail:hover {
    transform: scale(1.1);
    transition: transform 0.3s;
}
.badge {
    font-size: 0.9em;
    padding: 5px 10px;
}
</style>

{% endblock %}