{% extends './plantilla.html' %}
{% block contenido %}

<div class="container">
<h1>Listado de Personas</h1>


<a href="nuevaPersona" class="btn btn-primary">Agregar Persona</a>
<br>
<br>

<table class="table table-border table-striped table-hover" id = "tbl_personas">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Edad</th>
            <th>Telefono</th>
            <th>Correo</th>
            <th>Foto</th>
            {% if user.is_superuser %}
            <th>Acciones</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for personaTemporal in personas %}
        <tr>
            <td>{{ personaTemporal.id }}</td>
            <td>{{ personaTemporal.nombres }}</td>
            <td>{{ personaTemporal.apellidos }}</td>
            <td>{{ personaTemporal.edad }}</td>
            <td>{{ personaTemporal.telefono }}</td>
            <td>{{ personaTemporal.correo }}</td>
            <td>
                {% if personaTemporal.foto %}
                  <img src="{{personaTemporal.foto.url}}"
                  height="80px" alt="">
                 
                {% else %}
                  Ninguna
                {% endif%}
            </td>
            
            {% if user.is_superuser %}
            <td>
                <a href="editarPersona/{{personaTemporal.id}}" class="btn btn-outline-warning">
                    <i class="fa fa-pen"></i>
                </a>
                <a href="eliminarPersona/{{ personaTemporal.id }}" class="btnEliminar btn btn-outline-danger" data-id="{{ persona.id }}">
                    <i class="fa fa-trash"></i>
                </a>

                <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const botonesEliminar = document.querySelectorAll(".btnEliminar");

                    botonesEliminar.forEach(boton => {
                        boton.addEventListener("click", function (e) {
                            e.preventDefault(); 

                            const url = this.getAttribute("href");

                            Swal.fire({
                                title: "¿Estás seguro?",
                                text: "Una vez eliminado no hay vuelta atrás",
                                icon: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#3085d6",
                                cancelButtonColor: "#d33",
                                confirmButtonText: "Sí, eliminar",
                                cancelButtonText: "Cancelar"
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = url; 
                                }
                            });
                        });
                    });
                });
                </script>

                    
                
                
                


                
            </td>
            {% endif %}
        </tr>
        {% endfor %}
       
        
    </tbody>
</table>
</div>

<script>
    $(document).ready(function () {
      let table = new DataTable('#tbl_personas', {
        language: {
          url: 'https://cdn.datatables.net/plug-ins/2.3.1/i18n/es-ES.json'
        },
        dom: 'lBfrtip',
        pageLength: 3,
        
        buttons: [
          { extend: 'copy', text: 'Copiar', className: 'btn btn-primary me-2' },
          { extend: 'csv', text: 'CSV', className: 'btn btn-info me-2' },
          { extend: 'excel', text: 'Excel', className: 'btn btn-success me-2' },
          { extend: 'pdf', text: 'PDF', className: 'btn btn-danger me-2' },
          { extend: 'print', text: 'Imprimir', className: 'btn btn-secondary me-2' }
        ]

      });
    });
  </script>

    
<br><br><br><br><br><br>
{% endblock %}
